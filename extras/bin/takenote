#!/bin/zsh

# set -e

ARG1=$1
# echo $ARG1
NOTESDIR=~/notes
if [[ $ARG1 == "-p" ]]; then
   echo "Private note";
   NOTESDIR=~/notes/private
fi
[[ $ARG1 == "-p" ]] && shift;

ARG=$@
ARG=${ARG// /-}

NOTE=$ARG
NOTE=$(basename "$NOTE")
EXT="${NOTE##*.}"
FILE="$NOTESDIR/$NOTE"

if [[ -f $ARG ]]; then
   FILE=$ARG
else
   [[ ! "$EXT" == "md" ]] && [[ ! -f $FILE ]] && NOTE="$NOTE.md" 
   FILE="$NOTESDIR/$NOTE"
fi

TITLE="${(C)NOTE}"

# echo $ARG


[ ! -d "$NOTESDIR" ] && mkdir $NOTESDIR

cd $NOTESDIR

if [[ -f $FILE ]]; then
   vim -c 'set statusline="hello dear"' $FILE +6 
   exit
fi

touch $NOTE
DATE=$(date '+%Y-%m-%d %H:%M:%S')
cat << EOD >> $NOTE 
# $TITLE

----------------------------------------- 

\`\`\`bash

\`\`\`

-----------------------------------------
$DATE
EOD

vim $NOTE +6 
res=$?
if [[ $res == 1 ]]; then
   rm $NOTE
   echo "Note [${bR}$NOTESDIR/$NOTE${cZ}] not saved"
else
   echo "Your note was saved in [${bG}$NOTESDIR/$NOTE${cZ}]"
fi


exit $ret
