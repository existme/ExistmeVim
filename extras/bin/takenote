#!/bin/zsh

# set -e

ARG1=$1
# echo $ARG1
[[ $ARG1 == "-p" ]] && shift;

ARG=$@
TITLE="${(C)ARG}"
ARG=${ARG// /-}

# echo $ARG

NOTESDIR=~/notes

if [[ $ARG1 == "-p" ]]; then
   echo "Private note";
   NOTESDIR=~/notes/private
fi

NOTE=$ARG
FILE="$NOTESDIR/$NOTE"
EXT="${NOTE##*.}"
[[ ! $EXT -eq "md" ]] && echo "NOt [$FILE]"
[[ ! $EXT -eq "md" ]] && NOTE="$ARG.md" && FILE="$FILE.md"
echo "---> $FILE - $NOTE"
[ ! -d "$NOTESDIR" ] && mkdir $NOTESDIR

cd $NOTESDIR

EXT="${NOTE##*.}"
NOTE=$(basename "$NOTE")
echo $EXT-$NOTE-$NOTESDIR/$NOTE-$FILE
NOTE="${NOTE%.*}"
if [[ -f $FILE ]]; then
   vim -c 'set statusline="hello dear"' $FILE +6 
   exit
fi

touch $NOTE
DATE=$(date '+%Y-%m-%d %H:%M:%S')
cat << EOD >> $NOTE 
# $TITLE

----------------------------------------- 

\`\`\`bash

\`\`\`

-----------------------------------------
$DATE
EOD

vim $NOTE +6 
res=$?
if [[ $res == 1 ]]; then
   rm $NOTE
   echo "Note [${bR}$NOTESDIR/$NOTE${cZ}] not saved"
else
   echo "Your note was saved in [${bG}$NOTESDIR/$NOTE${cZ}]"
fi


exit $ret
